<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Google Login</title>

  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    body {
      font-family: Arial;
      padding: 40px;
      max-width: 600px;
      margin: auto;
    }
    button {
      padding: 10px 16px;
      margin-top: 16px;
      font-size: 14px;
      cursor: pointer;
    }
    pre {
      background: #f5f5f5;
      padding: 12px;
      margin-top: 16px;
    }
  </style>
</head>

<body>

<h2>Sign in with Google</h2>

<p>
This login uses Google OAuth and does <b>not</b> show any unsafe app warning.
</p>

<!-- Google Sign-In -->
<div id="g_id_onload"
     data-client_id="212447856028-6gftma5mka184ov2k843kvo3d45pic4h.apps.googleusercontent.com"
     data-callback="onLogin"
     data-auto_prompt="false">
</div>

<div class="g_id_signin"></div>

<hr>

<h3>My Apps</h3>

<button onclick="callApp('reminder')">Call Reminder</button>
<button onclick="callApp('weather')">Call Weather</button>
<button onclick="callApp('traffic')">Call Traffic</button>

<pre id="output"></pre>

<script>
let idToken = null;

// Called after Google login
function onLogin(response) {
  idToken = response.credential;
  alert("Google login successful");
}

// Call gateway â†’ target app
function callApp(appName) {
  if (!idToken) {
    alert("Please login first");
    return;
  }

fetch(
  "https://script.google.com/macros/s/AKfycbypG0fjceHnvHXsPyKEpp03dL7bQHYo44PPt47cmnatGSgmJ4YgZO8F0vrSicyqxa5S/exec?app=" + appName,
  {
    method: "POST",
    headers: {
      "Authorization": "Bearer " + idToken,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ action: "test" })
  }
)

  .then(r => r.text())
  .then(t => document.getElementById("output").textContent = t)
  .catch(err => alert("Error calling app"));
}
</script>

</body>
</html>
